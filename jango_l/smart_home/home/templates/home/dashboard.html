{% extends 'home/base.html' %}
{% block content %}
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="{% url 'dashboard' %}">Smart Home</a>
    <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ml-auto">
            <li class="nav-item">
                <a class="nav-link" href="{% url 'add_device' %}">Add Device</a>
            </li>
        </ul>
    </div>
</nav>

<a href="#" class="btn btn-success mb-3" data-bs-toggle="modal" data-bs-target="#addDeviceModal">
    âž• Add Device
</a>

<div class="modal fade" id="addDeviceModal" tabindex="-1" aria-labelledby="addDeviceModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addDeviceModalLabel">Add New Device</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form method="POST" action="{% url 'add_device' %}">
        {% csrf_token %}
        <div class="modal-body">
            <div class="mb-3">
                <label for="name" class="form-label">Device Name</label>
                <input type="text" class="form-control" name="name" required>
            </div>
            <div class="mb-3">
                <label for="device_type" class="form-label">Device Type</label>
                <select class="form-select" name="device_type">
                    <option value="Light">Light</option>
                    <option value="Fan">Fan</option>
                    <option value="Sensor">Sensor</option>
                    <option value="Other">Other</option>
                </select>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-success">Add Device</button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="row row-cols-1 row-cols-md-3 g-4">
    {% for device in devices %}
    <div class="col">
        <div class="card p-3 shadow-lg rounded">
            <h4>{{ device.name }}</h4>
            <p class="text-muted">Type: {{ device.device_type }}</p>
            <p>Status: 
                <i class="fa fa-{{ device.is_on|yesno:'check-circle, times-circle' }} text-{{ device.is_on|yesno:'success,danger' }}"></i>
                <strong>{{ device.is_on|yesno:'ON,OFF' }}</strong>
            </p>
            
            <form method="POST" action="{% url 'toggle_device' device.id %}" style="display: inline;">
                {% csrf_token %}
                <button type="submit" class="btn btn-{{ device.is_on|yesno:'danger,primary' }} w-100">
                    Turn {{ device.is_on|yesno:'OFF,ON' }}
                </button>
            </form>
            
            <a href="{% url 'delete_device' device.id %}" class="btn btn-outline-danger ms-2 w-100 mt-2"
                onclick="return confirm('Are you sure you want to delete this device?');">
                ðŸ—‘ Delete
            </a>
        </div>
    </div>
    {% endfor %}
</div>

{% endblock %}
